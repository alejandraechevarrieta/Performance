@{
    ViewBag.Title = "Home Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
    //var perfil = "128";
    //var perfil = Request.QueryString["perfil"];
    var perfil = Session["perfil"];
    var idUsuario = Session["idUsuario"];
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title</title>
    <!-- Estilos de Bootstrap -->
    @*<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0/css/bootstrap.min.css">*@

    <!-- Estilos de DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css">
    <!-- JavaScript de jQuery (necesario para DataTables) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.0/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html {
            height: 100%;
        }

        /*Background color*/
        #grad1 {
            background-color: #f3f3f3;
        }
        .modalLoading {
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: rgba(214, 214, 214, 0.8) url('../../Content/img/puntos.gif') 50% 50% no-repeat;
            background-size: 300px 240px;
        }

        /*Dropdown List Exp Date*/
        select.list-dt {
            border: none;
            outline: 0;
            border-bottom: 1px solid #ccc;
            padding: 2px 5px 3px 5px;
            margin: 2px;
        }

            select.list-dt:focus {
                border-bottom: 2px solid skyblue;
            }


        .button-container {
            display: flex; /* Utilizar flexbox para alinear los botones */
            justify-content: space-between; /* Espaciar uniformemente los botones */
        }
        .modalLoading {
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: rgba(214, 214, 214, 0.8) url('../../Content/img/puntos.gif') 50% 50% no-repeat;
            background-size: 300px 240px;
        }
        .modal {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .nav-item {
            cursor: pointer; /* Cambia el cursor a una mano */
        }
        .grilla-btn {
            width: 150px;
            height: 40px;
            justify-content: center;
            align-items: center;
        }

        .cuadrado-btn {
            width: 30px;
            height: 30px;
            padding: 0;
            line-height: 30px;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .progress-bar {
            height: 40px; /* Ajusta la altura según sea necesario */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .btn-primary {
            background-color: #17AFB6;
        }
            .btn-primary:hover,
            .btn-primary:focus,
            .btn-primary:active {
                background-color: #17AFB6;
            }
    </style>


</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/progressbar.js/dist/progressbar.min.js"></script>

    <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
        @*<div class="row" style="margin: 30px; overflow:hidden; display: flex;" id="rowProvisorio">
            <a id="a" class="btn btn-primary" href="/PerformanceApp/Index/Crud?view=autoevaluacion" style="max-width: 18%;">Autoevaluación</a>
            <a id="b" class="btn btn-secondary" href="/PerformanceApp/Index/Crud?view=evaluacion" style="max-width: 18%; ">Evaluación</a>
            <a id="c" class="btn btn-warning" href="/PerformanceApp/Index/Crud?view=resumenAutoevaluacion" style="max-width: 18%; ">Resumen Autoevaluación</a>
        </div>*@
        <div style="margin-left: 2.5%; margin-block: 0.5%">
            <button id="instructivo" class="btn btn-secondary" onclick="DescargarInstructivo()" title="Instructivo" aria-label="Instructivo"> <i class=" fa fa-info-circle "></i></button>
            <button id="abrirModalBtn" class="btn btn-primary" title="Instructivo" aria-label="Instructivo"> <i class=" fa fa-video-camera"></i></button>
        </div>
        @*FILTROS SOLICITUDES*@
        @if (Convert.ToInt32(perfil) == 129)
        {
            <div class="row align-items-center" style="text-align: center; margin-top:20px;">
                <div class="form-group2 col-md-2" style="margin-left:2%;" data-toggle="tooltip" title="Alta performance año anterior">
                    <button id="altaPerformance" type="button" class="btn btn-block btn-warning" style="width: 200px; cursor: pointer;">
                        Alta Performance @(DateTime.Now.Year)
                    </button>
                </div>
                <div class="form-group2 col-md-9">
                    <div class="progress" style="margin-bottom: 50px;">
                        <div id="barraPendiente" class="progress-bar progress-bar-stripeds" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        <div id="barraCompletado" class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        <div id="barraEvaluado" class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        <div id="barraFeedback" class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        <div id="barraFinalizado" class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <div class="tracking" id="progresoPerformance" style="margin-bottom: 20px; margin-left:480px">
                    <div class="text-uppercase text-xl font-weight-bolder opacity-7" id="tituloProgreso" style="width:auto">Progreso Performance @(DateTime.Now.Year)</div>
                </div>
            </div>
        }
        <div class="row m-3" style="overflow: hidden; margin-top: 0px;" id="rowFiltro">
            @if (Convert.ToInt32(perfil) == 128 || Convert.ToInt32(perfil) == 129)
            {
                if (Convert.ToInt32(perfil) == 128 || Convert.ToInt32(perfil) == 129)
                {
                    <div class="form-group2 col-md-2" id="filtroColaborador">
                        <label>Colaborador:</label>
                        <div></div>
                        <div style="font-weight: normal !important;">
                            <select class="form-control" id="selectColaborador"></select>
                        </div>
                    </div>
                }
                if (Convert.ToInt32(perfil) == 129)
                {
                    <div class="form-group2 col-md-2" id="filtroLider">
                        <label>Líder:</label>
                        <div></div>
                        <div style="font-weight: normal !important;">
                            <select class="form-control" id="selectLider"></select>
                        </div>
                    </div>
                }
                <div class="form-group2 col-md-2" id="filtroEstado">
                    <label>Estado:</label>
                    <div></div>
                    <select class="form-control" id="selectEstado">
                    </select>
                </div>
                <div class="form-group2 col-md-1 mt-2" style="padding-top: 1.9%;" id="btnBuscarFiltro">
                    <button id="btnFiltrar" type="button" class="btn btn-success" style="width: 120px; cursor: pointer;">
                        Buscar
                    </button>
                </div>
                <div class="form-group2 col-md-1 mt-2" style="padding-top: 1.9%; margin-left:10px;" id="btnLimpiar">
                    <button id="btnFiltrar" type="button" class="btn btn-info" style="width: 120px; cursor: pointer;">
                        Limpiar
                    </button>
                </div>
                if (Convert.ToInt32(perfil) == 129)
                {
                    <div class="col-md-2" style="margin-left:150px;">
                        <div class="d-flex flex-column border p-3">
                            <div id="totalPendiente" class="mb-2"><span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #7AC11F !important; "></span> Pendiente</div>
                            <div id="totalCompletado" class="mb-2"><span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #FFC107 !important;"></span> Completado</div>
                            <div id="totalEvaluado" class="mb-2"><span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #69E6FF !important;"></span> Evaluado</div>
                            <div id="totalFeedback" class="mb-2"><span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #17AFB6 !important;"></span> Feedback</div>
                            <div id="totalFinalizado" class="mb-2"><span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #9b9b9b !important;"></span> Finalizado</div>
                        </div>
                    </div>
                }
            }

        </div>

        <!-- MultiStep Form -->
        <div class="container-fluid py-4" id="grad1">
            <!-- TABLA COLABORADOR -->
            @if (Convert.ToInt32(perfil) == 127)
            {
                <div class="row">
                    <div class="col-12">
                        <div class="card mb-4">
                            <div class="card-header pb-0">
                                <div class="text-uppercase text-xl-center  font-weight-bolder opacity-7">Performance Colaborador</div>
                            </div>
                            <div class="card-body px-0 pt-0 pb-2">
                                <div class="table-responsive p-4">
                                    <table class="table align-items-center mb-0" id="tablaColaborador">
                                        <thead>
                                            <tr>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Año Performance</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Colaborador</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Líder</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Fecha de Autoevaluación</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Fecha de Feedback</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Estado</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Los datos de la tabla se agregarán aquí dinámicamente desde JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
            @if (Convert.ToInt32(perfil) == 128)
            {
                <div class="row">
                    <div class="col-12">
                        <div class="card mb-4">
                            <div class="card-header pb-0">
                                <div class="text-uppercase text-xl-center  font-weight-bolder opacity-7">Performance Líder</div>
                            </div>
                            <div class="card-body px-0 pt-0 pb-2">
                                <div class="table-responsive p-4">
                                    <table class="table align-items-center mb-0" id="tablaLider">
                                        <thead>
                                            <tr>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Año Performance</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Colaborador</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Fecha de Autoevaluación</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Fecha de Evaluación</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Fecha de Calibración</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Estado</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Los datos de la tabla se agregarán aquí dinámicamente desde JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
            @if (Convert.ToInt32(perfil) == 129)
            {
                <div class="row">
                    <div class="col-12">
                        <div class="card mb-4">
                            <div class="card-header pb-0">
                                <div class="text-uppercase text-xl-center  font-weight-bolder opacity-7">Performance Capital Humano</div>
                            </div>
                            <div class="card-body px-0 pt-0 pb-2">
                                <div class="table-responsive p-0">
                                    <table class="table align-items-center mb-0" id="tablaRRHH">
                                        <thead>
                                            <tr>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Año Performance</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Colaborador</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Líder</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">F.Autoevaluación</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">F.Evaluación</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">F.Calibración</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">F.Feedback</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Estado</th>
                                                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Los datos de la tabla se agregarán aquí dinámicamente desde JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
        @*modal preguntar si esta seguro *@
        <div class="modal" id="modalAltas" style="display: none!important; margin-top: 0%;">
            <div class="modal-dialog" style="max-width: 900px!important;">
                <div class="modal-content p-2">
                    <div class="row mb-3 m-2" style="justify-content:center">
                        <p class="h4" style="margin-left: 0px; margin-right:0px;"> Desea dar de alta las performance @(DateTime.Now.Year) de los colaboradores</p>
                    </div>
                    <div class="row mb-3 pr-2">
                        <div class="col-md-6">
                            <a href="#" role="button" class="btn btn-danger btn-sm btn-block" id="cerrarAlta" style="margin-left: 60%; width: 40%;">Cancelar</a>
                        </div>
                        <div class="col-md-6">
                            <a href="#" role="button" class="btn btn-info btn-sm btn-block" id="generarAlta" style="width: 40%;">Generar</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        @*modal altas ok *@
        <div class="modal" id="modalAltasOk" style="display: none!important; margin-top: 0%;">
            <div class="modal-dialog" style="max-width: 900px!important;">
                <div class="modal-content p-2">
                    <div class="row mb-3 m-2" style="justify-content:center">
                        <p class="h4" style="margin-left: 0px; margin-right:0px;">Se generaron las altas de performance @(DateTime.Now.Year) con éxito</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- DataTables JS CDN -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

    <!-- JavaScript personalizado -->
    <script>
        var perfil = "@perfil";
        $("#divLoading").hide();
    //Codigo para checkbox
    const checkboxes = document.querySelectorAll('.form-check-input');

    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('click', () => {
            checkboxes.forEach(otherCheckbox => {
                if (otherCheckbox !== checkbox) {
                    otherCheckbox.checked = false;
                }
            });
        });
    });

        $(document).ready(function () {
            CargarEstados();
            ListarPerformance();
            CargarColaboradoresFiltro();
            CargarLideresFiltro();
        });

    //Funcion para que ande el popover
    $(document).ready(function () {
        $('[data-toggle="popover"]').popover();
    });
    //Active para navbar
    $(document).ready(function () {
        $('#navIndex').addClass('active');
    });
    ///FILTROS
        $('#btnFiltrar').click(function () {
            ListarPerformance();
        });
        $('#btnLimpiar').click(function () {
            LimpiarFiltros();
        });
        function LimpiarFiltros() {
            $('#selectColaborador').val('');
            $('#selectEstado').val('');
            $('#selectLider').val('');
            ListarPerformance();
        }
    ///LISTAR PERFORMANCE
        function ListarPerformance() {
            var colaborador = $("#selectColaborador").val();
            var estado = $("#selectEstado").val();
            var lider = $("#selectLider").val();
            var url = "Api/PerformanceApp/ListarPerformance";
            url = url + "?idUsuario=" + "@idUsuario";
            url = url + "&idPerfil=" + "@perfil";
            url = url + "&colaborador=" + colaborador;
            url = url + "&estado=" + estado;
            url = url + "&lider=" + lider;

            if ("@perfil" == "127") {//Tabla del colaborador
                IniciarTabla();
                $('#tablaColaborador').DataTable().clear().destroy();
                CargarTablaColaborador(url);
            }
            if ("@perfil" == "128") {//Tabla del lider
                IniciarTablaLider();
                $('#tablaLider').DataTable().clear().destroy();
                CargartablaLider(url);
            }
            if ("@perfil" == "129") {//Tabla del RRHH
                IniciarTablaRRHH();
                $('#tablaRRHH').DataTable().clear().destroy();
                CargartablaRRHH(url);
                ProgresoRendicion();
            }
            $("#divLoading").show();
        }

        //INICIAR TABLA DEL COLABORADOR
        function IniciarTabla() {
            var table = $('#tablaColaborador').DataTable();
            table.page('first').draw('page'); // Vuelve a la página 1 y actualiza la tabla
            table.clear().destroy();
        }
        function CargarTablaColaborador(url) {
            moment.locale('es');
            var table = $("#tablaColaborador").DataTable({
                "processing": true,
                "serverSide": true,
                "stateSave": true,
                "bDestroy": true,
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
                },
                "ajax": {
                    "url": url,
                    "type": "POST",
                    "contentType": "application/json",
                    "data": function (d) {
                        return JSON.stringify(d);
                    },
                    "datatype": "json"
                },
                "pageLength": 25,
                "filter": true,
                "responsivePriority": 1,
                "columnDefs": [
                    { "width": "7%", "targets": 0 },
                    { "width": "20%", "targets": 1 },
                    { "width": "20%", "targets": 2 },
                    { "width": "7%", "targets": 3 },
                    { "width": "7%", "targets": 4 },
                    { "width": "10%", "targets": 5 },

                ],
                "columns": [
                    {
                        "data": "ano",
                        "name": "Año",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "nombre",
                        "name": "Colaborador",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "nombreJefe",
                        "name": "Líder",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "fechaAutoevaluacion",
                        "name": "Fecha de Autoevaluación",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "fechaEvaluacion",
                        "name": "Fecha de Evaluación",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "idEstado",
                        "name": "Estado",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data == 1) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=autoevaluacion&idPerformance=' + row.idPerformance + '&nombre=' + row.nombre + '" class="btn btn-sm grilla-btn btn-info" title="Autoevaluación sin realizar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 2) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-warning" title="Autoevaluación realizada, sin Evaluación" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 3) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-success" title="Evaluación del líder realizada" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 4) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-primary" title=" Evaluación realizada, Calibración realizada, Etapa de Feedback Abierta" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 5) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-secondary" title="Proceso de Performance Completado" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                        }
                    },
                ],
                "createdRow": function (row, data, index) {

                },
                "ordering": true,
                "paging": true,
                "initComplete": function () {
                    $("#divLoading").hide();
                }
            });
        };
        //INICIAR TABLA DEL LIDER
        function IniciarTablaLider() {
            $('#tablaLider').DataTable().clear().destroy();
            var table = $('#tablaLider').DataTable();
            table.page('first').draw('page'); // Vuelve a la página 1 y actualiza la tabla
        }
        function CargartablaLider(url) {
            moment.locale('es');
            var table = $("#tablaLider").DataTable({
                "processing": true,
                "serverSide": true,
                "stateSave": true,
                "bDestroy": true,
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
                },
                "ajax": {
                    "url": url,
                    "type": "POST",
                    "contentType": "application/json",
                    "data": function (d) {
                        return JSON.stringify(d);
                    },
                    "datatype": "json"
                },
                "pageLength": 25,
                "filter": true,
                "responsivePriority": 1,
                "columnDefs": [
                    { "width": "10%", "targets": 0 },
                    { "width": "26%", "targets": 1 },
                    { "width": "16%", "targets": 2 },
                    { "width": "16%", "targets": 3 },
                    { "width": "16%", "targets": 4 },
                    { "width": "16%", "targets": 5 },
                ],
                "columns": [
                    {
                        "data": "ano",
                        "name": "Año Performance",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "nombre",
                        "name": "Colaborador",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "fechaAutoevaluacion",
                        "name": "Fecha de Autoevaluación",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            }
                            else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "fechaEvaluacion",
                        "name": "Fecha de Evaluación",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            }
                            else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "fechaCalibracion",
                        "name": "Fecha de Calibración",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            }
                            else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "idEstado",
                        "name": "Estado",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data == 1) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=evaluacion&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-info" title="Autoevaluación sin realizar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 2) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=evaluacion&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-warning" title="Autoevaluación realizada, sin Evaluación" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 3) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-success" title="Evaluación del líder realizada" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 4) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-primary" title=" Evaluación realizada, Calibración realizada, Etapa de Feedback Abierta" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 5) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-secondary" title="Proceso de Performance Completado" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                        }
                    },
                ],
                "createdRow": function (row, data, index) {
                    // Aquí puedes aplicar estilos o clases a las filas según tus datos
                },
                "ordering": true,
                "paging": true,
                "initComplete": function () {
                    $("#divLoading").hide();
                }
            });
        };

        //INICIAR TABLA RRHH
        function IniciarTablaRRHH() {
            var table = $('#tablaRRHH').DataTable();
            table.page('first').draw('page'); // Vuelve a la página 1 y actualiza la tabla
            table.clear().destroy();
        }
        function CargartablaRRHH(url) {
            moment.locale('es');
            var table = $("#tablaRRHH").DataTable({
                "processing": true,
                "serverSide": true,
                "stateSave": true,
                "bDestroy": true,
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
                },
                "ajax": {
                    "url": url,
                    "type": "POST",
                    "contentType": "application/json",
                    "data": function (d) {
                        return JSON.stringify(d);

                    },
                    "datatype": "json",
                },
                "pageLength": 25,
                "filter": true,
                "responsivePriority": 1,
                "columnDefs": [
                    { "width": "7%", "targets": 0 },
                    { "width": "15%", "targets": 1 },
                    { "width": "15%", "targets": 2 },
                    { "width": "5%", "targets": 3 },
                    { "width": "5%", "targets": 4 },
                    { "width": "5%", "targets": 5 },
                    { "width": "5%", "targets": 6 },
                    { "width": "10%", "targets": 7 },
                    { "width": "7%", "targets": 8 },
                ],
                "columns": [
                    {
                        "data": "ano",
                        "name": "Año",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "nombre",
                        "name": "Colaborador",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "nombreJefe",
                        "name": "Líder",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="text-align: center;">' + data + '</div>'
                        }
                    },
                    {
                        "data": "fechaAutoevaluacion",
                        "name": "Fecha de Autoevaluación",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "fechaEvaluacion",
                        "name": "Fecha de Evaluación",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "fechaCalibracion",
                        "name": "Fecha de Calibración",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "fechaFeedback",
                        "name": "Fecha de Feedback",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data !== null) {
                                return '<div style="text-align: center;">' + moment(data).format('DD/MM/YYYY') + '</div>'
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        "data": "idEstado",
                        "name": "Estado",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            if (data == 1) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-info" title="Autoevaluación sin realizar" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 2) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-warning" title="Autoevaluación realizada, sin Evaluación" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 3) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-success" title="Evaluación del líder realizada" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 4) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-primary" title=" Evaluación realizada, Calibración realizada, Etapa de Feedback Abierta" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                            if (data == 5) {
                                return '<div style="text-align: center;"><a href="/PerformanceApp/Index/Crud?view=performance&idPerformance=' + row.idPerformance + '" class="btn btn-sm grilla-btn btn-secondary" title="Proceso de Performance Completado" style="font-size: 100% !important;">' + row.estado + '</a></div>';
                            }
                        }
                    },
                    {
                        "data": "estado",
                        "name": "Acciones",
                        "autoWidth": false,
                        "render": function (data, type, row, meta) {
                            return '<div style="display: flex; justify-content: center;">' +
                                "<a href=# class='btn btn-sm btn-danger cuadrado-btn' style='color:white;' title='Eliminar' id='btnEliminar' onclick=\"EliminarPerformance(" + row.idPerformance + ")\"><i class='fa fa-close'></i></a>" +
                                '</div>';

                        }
                    },

                ],
                "createdRow": function (row, data, index) {
                    // Aquí puedes aplicar estilos o clases a las filas según tus datos

                },
                "ordering": true,
                "paging": true,
                "initComplete": function () {
                    $("#divLoading").hide();
                }
            });
        };


        function CargarEstados() {
            var selecEstados = $('#selectEstado');
            selecEstados.empty();
            selecEstados.append($('<option/>', { value: '', text: 'Seleccionar' }).hide());
            var url = "Api/PerformanceApp/listarEstadosPerformance";
            $.getJSON(url)
                .done(function (data) {
                    console.log(data);
                    $.each(data, function (index, result) {
                        selecEstados.append($('<option/>', {
                            value: result.id,
                            text: result.estado
                        }));
                    });
                });
        }
        @*var token = "";
        GenerarToken();
        function GenerarToken() {
            var url = "Api/PerformanceApp/EnviarMailLider?idUsuario=" + @idUsuario + "&idDestinatario=" + 2125;
            $.getJSON(url)
                .done(function (data) {
                });
        }*@

        function CargarColaboradoresFiltro() {
            var selectColaborador = $('#selectColaborador');
            selectColaborador.empty();
            selectColaborador.append($('<option/>', { value: '', text: 'Seleccionar' }).hide());
            var url = "Api/PerformanceApp/ListarColaboradores";
            $.getJSON(url)
                .done(function (data) {
                    console.log(data);
                    $.each(data, function (index, result) {
                        selectColaborador.append($('<option/>', {
                            value: result.idUsuario,
                            text: result.nombre
                        }));
                    });
                });
        }
        function CargarLideresFiltro() {
            var selectLider = $('#selectLider');
            selectLider.empty();
            selectLider.append($('<option/>', { value: '', text: 'Seleccionar' }).hide());
            var url = "Api/PerformanceApp/ListarLideres";
            $.getJSON(url)
                .done(function (data) {
                    console.log(data);
                    $.each(data, function (index, result) {
                        selectLider.append($('<option/>', {
                            value: result.idUsuario,
                            text: result.nombreJefe
                        }));
                    });
                });
        }
        //ALTAS
        $('#altaPerformance').click(function () {
            $('#modalAltas').show();
        });
        $('#cerrarAlta').click(function () {
            $('#modalAltas').hide();
        });
        $('#generarAlta').click(function () {
            $.ajax({
                url: "/PerformanceApp/Api/PerformanceApp/GenerarAltasPerformance",
                type: 'GET',
                data: {

                },
                dataType: 'json',
                success: function (data) {
                    if (data > 0) {
                        $('#modalAltas').hide();
                        $('#modalAltasOk').show();
                        setTimeout(function () {
                            $('#modalAltasOk').hide();
                        }, 3000);
                        ListarPerformance();
                    } else {
                        alert('Error al generar las altas ' + data)
                        $('#modalAltas').hide();
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    alert("Error en la solicitud: " + errorThrown);
                }
            });

        });
        function ProgresoRendicion() {
           var url = "Api/PerformanceApp/ListarPerformanceProgreso";

            $.getJSON(url)
                .done(function (data) {
                    var datos = data[0];

                    var totalPendiente = datos.totalPendiente;
                    var totalCompletado = datos.totalCompletado;
                    var totalEvaluado = datos.totalEvaluado;
                    var totalFeedback = datos.totalFeedback;
                    var totalFinalizado = datos.totalFinalizado;

                    var porcentajePendiente = datos.porcentajePendiente;
                    var porcentajeCompletado = datos.porcentajeCompletado;
                    var porcentajeEvaluado = datos.porcentajeEvaluado;
                    var porcentajeFeedback = datos.porcentajeFeedback;
                    var porcentajeFinalizado = datos.porcentajeFinalizado;

                    var stylePendiente = "width: " + porcentajePendiente + "%; background-color: #7AC11F"; // Verde
                    var styleCompletado = "width: " + porcentajeCompletado + "%; background-color: #FFC107";     // Amarillo
                    var styleEvaluado = "width: " + porcentajeEvaluado + "%; background-color: #69E6FF";   // Azul
                    var styleFeedback = "width: " + porcentajeFeedback + "%; background-color: #17AFB6"; // gris
                    var styleFinalizado = "width: " + porcentajeFinalizado + "%; background-color: #9b9b9b"; // gris

                    // Configurar las barras de progreso con un ancho más grande
                    $("#barraPendiente").attr("style", stylePendiente).text(Math.round(porcentajePendiente) + "%");
                    $("#barraCompletado").attr("style", styleCompletado).text(Math.round(porcentajeCompletado) + "%");
                    $("#barraEvaluado").attr("style", styleEvaluado).text(Math.round(porcentajeEvaluado) + "%");
                    $("#barraFeedback").attr("style", styleFeedback).text(Math.round(porcentajeFeedback) + "%");
                    $("#barraFinalizado").attr("style", styleFinalizado).text(Math.round(porcentajeFinalizado) + "%");

                    //completo el total en las referencias
                    $("#totalPendiente").html('<span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #7AC11F !important;"></span> Pendiente: ' + totalPendiente);
                    $("#totalCompletado").html('<span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #FFC107 !important;"></span> Completado: ' + totalCompletado);
                    $("#totalEvaluado").html('<span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #69E6FF !important;"></span> Evaluado: ' + totalEvaluado);
                    $("#totalFeedback").html('<span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #17AFB6 !important;"></span> Feedback: ' + totalFeedback);
                    $("#totalFinalizado").html('<span class="mr-3" style="width: 20px; height: 20px; display: inline-block; background-color: #9b9b9b !important;"></span> Finalizado: ' + totalFinalizado);
                });
        }
        function DescargarInstructivo() {
            var url = 'Api/PerformanceApp/DescargarInstructivo';
            window.location.href = url;
        }

    </script>

</body>
</html>
